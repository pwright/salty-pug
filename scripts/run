#!/usr/bin/python3

import requests

from plano import *

ENV["STORE_SERVICE_STORE_ID"] = store_id = "1"

ENV["STORE_SERVICE_HOST"] = store_host = "localhost"
ENV["STORE_SERVICE_PORT"] = store_port = str(get_random_port())

ENV["STORE_SERVICE_HOST_OVERRIDE"] = store_host

ENV["STORE_SERVICE_HOST_ALL"] = store_host
ENV["STORE_SERVICE_PORT_ALL"] = store_port

ENV["FACTORY_SERVICE_FACTORY_ID"] = factory_id = "1"

ENV["FACTORY_SERVICE_HOST"] = factory_host = "localhost"
ENV["FACTORY_SERVICE_PORT"] = factory_port = str(get_random_port())

ENV["FACTORY_SERVICE_HOST_ANY"] = factory_host
ENV["FACTORY_SERVICE_PORT_ANY"] = factory_port

ENV["CONSOLE_SERVICE_HOST"] = console_host = "localhost"
ENV["CONSOLE_SERVICE_PORT"] = console_port = str(8080)

try:
    with start_process("python3 store/app.py") as store:
        with start_process("python3 factory/app.py") as factory:
            with start_process("python3 console/app.py") as console:
                while True:
                    sleep(1)
except KeyboardInterrupt:
    pass
